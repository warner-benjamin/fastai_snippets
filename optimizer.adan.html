<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="With fastai native, fused ForEach, and fused TorchScript implementations">

<title>fastxtend - Adan: ADAptive Nesterov Momentum Optimizer</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="fastxtend - Adan: ADAptive Nesterov Momentum Optimizer">
<meta property="og:description" content="With fastai native, fused ForEach, and fused TorchScript implementations">
<meta property="og:site-name" content="fastxtend">
<meta name="twitter:title" content="fastxtend - Adan: ADAptive Nesterov Momentum Optimizer">
<meta name="twitter:description" content="With fastai native, fused ForEach, and fused TorchScript implementations">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">fastxtend</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://benjaminwarner.dev" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="https://docs.fast.ai" rel="" target=""><i class="bi bi-link" role="img">
</i> 
 <span class="dropdown-text">fast.ai</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://fastcore.fast.ai" rel="" target=""><i class="bi bi-link" role="img">
</i> 
 <span class="dropdown-text">fastcore</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://nbdev.fast.ai" rel="" target=""><i class="bi bi-link" role="img">
</i> 
 <span class="dropdown-text">nbdev</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/warner-benjamin/fastxtend/issues" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/warner-benjamin/fastxtend/" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/benjamin_warner" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./optimizer.fused.html">Optimizers</a></li><li class="breadcrumb-item"><a href="./optimizer.adan.html">Adan Optimizer</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">fastxtend</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Callbacks</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.channelslast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Channels Last</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.cutmixup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CutMixUp &amp; Friends</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.ema.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exponential Moving Average</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.gradaccum.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gradient Accumulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.lr_finder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learning Rate Finder</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.amp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mixed Precision</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.profiler.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Profiler Callbacks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.progresize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Progressive Resizing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.compiler.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">PyTorch Compile</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.tracker.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Callbacks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./callback.utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Callback Utilities</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">FFCV [beta]</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.fields.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fields</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.loader.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loader</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Operations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transforms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.writer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Writer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ffcv.inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Inference</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Losses</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./losses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Loss Functions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiloss.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MultiLoss</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Metrics Extended</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedulers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedulers</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Splitters</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Optimizers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizer.fused.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fused fastai Optimizers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizer.eightbit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8-Bit Optimizers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizer.adan.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Adan Optimizer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizer.lion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lion Optimizer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizer.sophia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sophia Optimizer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimizer.stableadam.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StableAdam Optimizer</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Vision</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Augmentations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vision.augment.batch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Additional Batch Augmentations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vision.augment.itemtensor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tensor Item Transforms</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vision.data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vision Data</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vision.models.attention_modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Attention Modules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vision.models.pooling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pooling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vision.models.xresnet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">XResNet Extended</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">Text</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text.huggingface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hugging Face</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">Audio</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio.01_core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio.02_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio.03_augment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Augmentations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio.04_learner.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learner</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio.05_mixup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MixUp &amp; Friends</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">Utils</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transform</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utility</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#adan" id="toc-adan" class="nav-link active" data-scroll-target="#adan">Adan</a></li>
  <li><a href="#adan-1" id="toc-adan-1" class="nav-link" data-scroll-target="#adan-1">adan</a></li>
  <li><a href="#adanlargebatchlr" id="toc-adanlargebatchlr" class="nav-link" data-scroll-target="#adanlargebatchlr">AdanLargeBatchLR</a></li>
  <li><a href="#hyperparameters" id="toc-hyperparameters" class="nav-link" data-scroll-target="#hyperparameters">Hyperparameters</a></li>
  <li><a href="#training-speed" id="toc-training-speed" class="nav-link" data-scroll-target="#training-speed">Training Speed</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/warner-benjamin/fastxtend/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Adan: ADAptive Nesterov Momentum Optimizer</h1>
</div>

<div>
  <div class="description">
    With fastai native, fused ForEach, and fused TorchScript implementations
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>
<script src="https://static.cloudflareinsights.com/beacon.min.js?token=62f27bdcb8964407a52676798db9edfa" defer=""></script>
<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>Adan was introduced by Xie et al in <em><a href="https://arxiv.org/abs/2208.06677">Adan: Adaptive Nesterov Momentum Algorithm for Faster Optimizing Deep Models</a></em>. Adan uses a efficient Nesterov momentum estimation method to avoid the extra computation and memory overhead of calculating the extrapolation point gradient.</p>
<p><a href="https://openreview.net/forum?id=OM0jvwB8jIp57ZJjtNEZ">Nadam</a> also estimates Nesterov momentum, but in contrast it only estimates the first-order gradient moment while Adan estimates both first- and second-order movements.</p>
<p>For consistency with other fastai optimizers, the coefficients <code>beta1</code>, <code>beta2</code>, and <code>beta3</code> have been inversed from the paper values, e.g.&nbsp;<code>β1=0.98</code> instead of <code>β1=0.02</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This implementation of <a href="https://fastxtend.benjaminwarner.dev/optimizer.adan.html#adan"><code>Adan</code></a> does not contain the restart condition, as it is mostly unused in the paper.</p>
</div>
</div>
<p>In addition to a fastai native implementation, <a href="https://fastxtend.benjaminwarner.dev/optimizer.adan.html#adan"><code>Adan</code></a> has fused ForEach and Torchscript implementations. See the <a href="optimizer.fused.html">Fused Optimizer</a> documentation for more details.</p>
<hr>
<p><a href="https://github.com/warner-benjamin/fastxtend/blob/main/fastxtend/optimizer/adan.py#L239" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="adan" class="level3">
<h3 class="anchored" data-anchor-id="adan">Adan</h3>
<blockquote class="blockquote">
<pre><code> Adan (params:Union[torch.Tensor,Iterable[torch.Tensor],MutableSequence[to
       rch.Tensor],fastcore.foundation.L,fastcore.basics.fastuple],
       lr:float, beta1:float=0.98, beta2:float=0.92, beta3:float=0.99,
       eps:float=1e-08, wd:float=0.02, paper_init:bool=False,
       foreach:bool=False, jit:bool=False)</code></pre>
</blockquote>
<p>A fastai Adan optimizer with optional ForEach and TorchScript implementations</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>params</td>
<td>Listified[Tensor]</td>
<td></td>
<td>Model parameters or parameter groups</td>
</tr>
<tr class="even">
<td>lr</td>
<td>float</td>
<td></td>
<td>Default learning rate</td>
</tr>
<tr class="odd">
<td>beta1</td>
<td>float</td>
<td>0.98</td>
<td>Gradient moving average (β1) coefficient</td>
</tr>
<tr class="even">
<td>beta2</td>
<td>float</td>
<td>0.92</td>
<td>Gradient difference moving average (β2) coefficient</td>
</tr>
<tr class="odd">
<td>beta3</td>
<td>float</td>
<td>0.99</td>
<td>Gradient squared moving average (β3) coefficient</td>
</tr>
<tr class="even">
<td>eps</td>
<td>float</td>
<td>1e-08</td>
<td>Added for numerical stability</td>
</tr>
<tr class="odd">
<td>wd</td>
<td>float</td>
<td>0.02</td>
<td>True weight decay</td>
</tr>
<tr class="even">
<td>paper_init</td>
<td>bool</td>
<td>False</td>
<td>Initialize prior gradient with current gradient per paper, or zeroes</td>
</tr>
<tr class="odd">
<td>foreach</td>
<td>bool</td>
<td>False</td>
<td>Use fused ForEach implementation</td>
</tr>
<tr class="even">
<td>jit</td>
<td>bool</td>
<td>False</td>
<td>Use fused TorchScript implementation</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Optimizer | AdanForEachOptimizer | JitOptimizer</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/warner-benjamin/fastxtend/blob/main/fastxtend/optimizer/adan.py#L263" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="adan-1" class="level3">
<h3 class="anchored" data-anchor-id="adan-1">adan</h3>
<blockquote class="blockquote">
<pre><code> adan (beta1:float=0.98, beta2:float=0.92, beta3:float=0.99,
       eps:float=1e-08, wd:float=0.02, paper_init:bool=False,
       foreach:bool=False, jit:bool=False)</code></pre>
</blockquote>
<p>Partial function for the Adan optimizer with fused ForEach and TorchScript implementations</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>beta1</td>
<td>float</td>
<td>0.98</td>
<td>Gradient moving average (β1) coefficient</td>
</tr>
<tr class="even">
<td>beta2</td>
<td>float</td>
<td>0.92</td>
<td>Gradient difference moving average (β2) coefficient</td>
</tr>
<tr class="odd">
<td>beta3</td>
<td>float</td>
<td>0.99</td>
<td>Gradient squared moving average (β3) coefficient</td>
</tr>
<tr class="even">
<td>eps</td>
<td>float</td>
<td>1e-08</td>
<td>Added for numerical stability</td>
</tr>
<tr class="odd">
<td>wd</td>
<td>float</td>
<td>0.02</td>
<td>True weight decay</td>
</tr>
<tr class="even">
<td>paper_init</td>
<td>bool</td>
<td>False</td>
<td>Initialize prior gradient with current gradient per paper, or zeroes</td>
</tr>
<tr class="odd">
<td>foreach</td>
<td>bool</td>
<td>False</td>
<td>Use fused ForEach implementation</td>
</tr>
<tr class="even">
<td>jit</td>
<td>bool</td>
<td>False</td>
<td>Use fused TorchScript implementation</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>Optimizer | AdanForEachOptimizer | JitOptimizer</strong></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/warner-benjamin/fastxtend/blob/main/fastxtend/optimizer/adan.py#L278" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="adanlargebatchlr" class="level3">
<h3 class="anchored" data-anchor-id="adanlargebatchlr">AdanLargeBatchLR</h3>
<blockquote class="blockquote">
<pre><code> AdanLargeBatchLR (bs:int)</code></pre>
</blockquote>
<p>Square root rule for scaling <a href="https://fastxtend.benjaminwarner.dev/optimizer.adan.html#adan"><code>Adan</code></a> learning rate for large-batch training</p>
</section>
<section id="hyperparameters" class="level2">
<h2 class="anchored" data-anchor-id="hyperparameters">Hyperparameters</h2>
<p>Hyperparameter notes from Xie et al:</p>
<ol type="1">
<li><code>beta2</code> is the least sensitive Adan hyperparameter, default of 0.92 works for majority of tasks</li>
<li>Xie et al primarily tune <code>beta3</code> (between 0.9-0.999) before <code>beta1</code> (between 0.9-0.98) for different tasks</li>
<li>Adan pairs well with large learning rates. Paper and GitHub report up to 3x larger than <a href="https://fastxtend.benjaminwarner.dev/optimizer.fused.html#lamb"><code>Lamb</code></a> and up to 5-10x larger than <a href="optimizer.fused.html#adam-optimizer"><code>AdamW</code></a></li>
<li>Xie et al use the default weight decay of 0.02 for all tasks except fine-tuning BERT (<code>wd=0.01</code>) and reinforcement learning (<code>wd=0</code>)</li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>With <code>paper_init=True</code>, fastxtend’s <a href="https://fastxtend.benjaminwarner.dev/optimizer.adan.html#adan"><code>Adan</code></a> matches Xie et al’s <a href="https://github.com/sail-sg/Adan">Adan implementation</a>.</p>
</div>
</div>
</section>
<section id="training-speed" class="level2">
<h2 class="anchored" data-anchor-id="training-speed">Training Speed</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>ForEach and TorchScript optimizers have only been tested on PyTorch 1.12+ and are not guaranteed to work on older versions.</p>
</div>
</div>
<p>One <a href="https://wandb.ai/capecape/adan_optimizer/reports/Adan-A-New-Optimizer-That-Challenges-Adam--VmlldzoyNTQ5NjQ5#conclusions">critique of Adan</a> is the original PyTorch implementation was significantly slower than AdamW. Between 41 to 97 percent slower on tested models. However, Xie et al’s implementation has been refactored to decrease memory usage and Cuda operations. These improvements have been ported to the fastxtend versions. This improved Adan implementation is benchmarked in <a href="#tbl-panel">Table&nbsp;2</a> below.</p>
<p>As shown in <a href="#tbl-fused">Table&nbsp;1</a>, fastxtend’s fused ForEach Adan is 36 to 401 percent faster<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> then a standard PyTorch implementation.</p>
<div id="tbl-fused" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Increase in Adan <code>opt_step</code> Speed vs Native Optimizer</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th style="text-align: center;">Layers</th>
<th style="text-align: center;">Native Step</th>
<th style="text-align: center;">ForEach Step</th>
<th style="text-align: center;">ForEach Speedup</th>
<th style="text-align: center;">JIT Step</th>
<th style="text-align: center;">JIT Speedup</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>XResNet18</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">31ms</td>
<td style="text-align: center;">13ms</td>
<td style="text-align: center;">150%</td>
<td style="text-align: center;">27ms</td>
<td style="text-align: center;">18%</td>
</tr>
<tr class="even">
<td>XResNet50</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">69ms</td>
<td style="text-align: center;">33ms</td>
<td style="text-align: center;">108%</td>
<td style="text-align: center;">56ms</td>
<td style="text-align: center;">24%</td>
</tr>
<tr class="odd">
<td>XSE-ResNeXt50</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">94ms</td>
<td style="text-align: center;">45ms</td>
<td style="text-align: center;">110%</td>
<td style="text-align: center;">75ms</td>
<td style="text-align: center;">25%</td>
</tr>
<tr class="even">
<td>XResNet101</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">115ms</td>
<td style="text-align: center;">46ms</td>
<td style="text-align: center;">148%</td>
<td style="text-align: center;">89ms</td>
<td style="text-align: center;">29%</td>
</tr>
<tr class="odd">
<td>ConvNeXt Tiny</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">139ms</td>
<td style="text-align: center;">102ms</td>
<td style="text-align: center;">36%</td>
<td style="text-align: center;">124ms</td>
<td style="text-align: center;">11%</td>
</tr>
<tr class="even">
<td>ConvNeXt Small</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">225ms</td>
<td style="text-align: center;">162ms</td>
<td style="text-align: center;">39%</td>
<td style="text-align: center;">198ms</td>
<td style="text-align: center;">13%</td>
</tr>
<tr class="odd">
<td>ViT Patch16 Small</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">76ms</td>
<td style="text-align: center;">46ms</td>
<td style="text-align: center;">65%</td>
<td style="text-align: center;">62ms</td>
<td style="text-align: center;">21%</td>
</tr>
<tr class="even">
<td>DeBERTa Base</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">42ms</td>
<td style="text-align: center;">8.4ms</td>
<td style="text-align: center;">401%</td>
<td style="text-align: center;">28ms</td>
<td style="text-align: center;">46%</td>
</tr>
</tbody>
</table>
</div>
<p>Now the Adan ForEach steps are only 1.6 to 17 percent slower than the AdamW ForEach steps, and the difference in performance and as a percentage of total training time is significantly smaller. An Adan ForEach step is 0.6ms to 4ms slower than an AdamW ForEach step across measured models, instead of 6ms to 29ms with Adan native as shown in <a href="#tbl-panel">Table&nbsp;2</a>.</p>
<div id="tbl-panel" class="tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table&nbsp;2: AdamW vs Adan Training Speed</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-native" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-panel" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(a) Native Implementation</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">AdamW Step</th>
<th style="text-align: center;">Adan Step</th>
<th style="text-align: center;">Slowdown</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">XResNet18</td>
<td style="text-align: center;">25ms</td>
<td style="text-align: center;">31ms</td>
<td style="text-align: center;">27%</td>
</tr>
<tr class="even">
<td style="text-align: center;">XResNet50</td>
<td style="text-align: center;">53ms</td>
<td style="text-align: center;">69ms</td>
<td style="text-align: center;">28%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">XSE-ResNeXt50</td>
<td style="text-align: center;">71ms</td>
<td style="text-align: center;">94ms</td>
<td style="text-align: center;">35%</td>
</tr>
<tr class="even">
<td style="text-align: center;">XResNet101</td>
<td style="text-align: center;">85ms</td>
<td style="text-align: center;">115ms</td>
<td style="text-align: center;">33%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ConvNeXt Tiny</td>
<td style="text-align: center;">124ms</td>
<td style="text-align: center;">139ms</td>
<td style="text-align: center;">12%</td>
</tr>
<tr class="even">
<td style="text-align: center;">ConvNeXt Small</td>
<td style="text-align: center;">196ms</td>
<td style="text-align: center;">225ms</td>
<td style="text-align: center;">15%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ViT Patch16 Small</td>
<td style="text-align: center;">63ms</td>
<td style="text-align: center;">76ms</td>
<td style="text-align: center;">20%</td>
</tr>
<tr class="even">
<td style="text-align: center;">DeBERTa Base</td>
<td style="text-align: center;">26ms</td>
<td style="text-align: center;">42ms</td>
<td style="text-align: center;">62%</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-foreach" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-panel" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(b) Fused ForEach Implementation</caption>
<thead>
<tr class="header">
<th style="text-align: center;">Model</th>
<th style="text-align: center;">AdamW Step</th>
<th style="text-align: center;">Adan Step</th>
<th style="text-align: center;">Slowdown</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">XResNet18</td>
<td style="text-align: center;">13ms</td>
<td style="text-align: center;">13ms</td>
<td style="text-align: center;">5.0%</td>
</tr>
<tr class="even">
<td style="text-align: center;">XResNet50</td>
<td style="text-align: center;">31ms</td>
<td style="text-align: center;">33ms</td>
<td style="text-align: center;">2.3%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">XSE-ResNeXt50</td>
<td style="text-align: center;">43ms</td>
<td style="text-align: center;">45ms</td>
<td style="text-align: center;">5.9%</td>
</tr>
<tr class="even">
<td style="text-align: center;">XResNet101</td>
<td style="text-align: center;">43ms</td>
<td style="text-align: center;">46ms</td>
<td style="text-align: center;">8.4%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ConvNeXt Tiny</td>
<td style="text-align: center;">100ms</td>
<td style="text-align: center;">102ms</td>
<td style="text-align: center;">1.6%</td>
</tr>
<tr class="even">
<td style="text-align: center;">ConvNeXt Small</td>
<td style="text-align: center;">159ms</td>
<td style="text-align: center;">162ms</td>
<td style="text-align: center;">1.6%</td>
</tr>
<tr class="odd">
<td style="text-align: center;">ViT Patch16 Small</td>
<td style="text-align: center;">44ms</td>
<td style="text-align: center;">46ms</td>
<td style="text-align: center;">2.9%</td>
</tr>
<tr class="even">
<td style="text-align: center;">DeBERTa Base</td>
<td style="text-align: center;">7.2ms</td>
<td style="text-align: center;">8.4ms</td>
<td style="text-align: center;">17%</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Benchmarked on a GeForce 3080 Ti using PyTorch 1.13.1, Cuda 11.7, Mixed Precision, <a href="callback.channelslast.html">Channels Last</a> (except DeBERTa and ViT), and fastxtend’s <a href="callback.simpleprofiler.html">Simple Profiler Callback</a>. Results may differ on other models, hardware, and across benchmarking runs. Speedup and slowdown are calculated from the total time spent on the optimization step.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp("https:\/\/fastxtend\.benjaminwarner\.dev\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright © 2023 Benjamin Warner, MIT License</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/warner-benjamin/fastxtend/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/benjamin_warner">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>