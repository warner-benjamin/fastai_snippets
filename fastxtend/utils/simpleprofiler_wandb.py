# AUTOGENERATED! DO NOT EDIT! File to edit: nbs/utils.simpleprofiler_wandb.ipynb (unless otherwise specified).

__all__ = []

# Cell
import wandb
from fastcore.foundation import patch
from fastai.callback.wandb import WandbCallback

# Internal Cell
if not hasattr(WandbCallback,'_orig_before_fit'): WandbCallback._orig_before_fit = WandbCallback.before_fit
if not hasattr(WandbCallback,'_orig_after_fit'): WandbCallback._orig_after_fit = WandbCallback.after_fit

# Internal Cell
@patch
def before_fit(self:WandbCallback):
    if not hasattr(self.learn, 'lr_finder') and hasattr(self.learn, 'simple_profiler'):
        self.log_simple_profiler = True
    else:
        self.log_simple_profiler = False

    self._orig_before_fit()

# Internal Cell
@patch
def after_fit(self:WandbCallback):
    self._orig_after_fit()

    if self.log_simple_profiler:
        report = wandb.Table(dataframe=self.learn.simple_profile_report)
        results = wandb.Table(dataframe=self.learn.simple_profile_results)

        wandb.log({"simple_profile_report": report})
        wandb.log({"simple_profile_results": results})
        wandb.log({}) # ensure sync

        self.log_simple_profiler = False